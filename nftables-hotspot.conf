#!/usr/sbin/nft -f
# uConsole Hotspot - nftables rules
# Split ip/ip6 tables for proper NAT handling

# IPv6 forwarding for tayga translated traffic
# No masquerade needed - tayga uses a public IPv6 address as source
table ip6 hotspot6 {
    chain forward {
        type filter hook forward priority filter; policy accept;
    }
}

# IPv4 NAT for client â†’ tayga
table ip hotspot4 {
    chain postrouting {
        type nat hook postrouting priority srcnat;
        oifname "nat64" masquerade
    }
    chain forward {
        type filter hook forward priority filter; policy accept;
    }
}

# Firewall - input protection only
table inet hotspot_fw {
    chain input {
        type filter hook input priority filter; policy drop;
        ct state established,related accept
        iif "lo" accept
        iifname "wlan0" udp dport 67 accept
        iifname "wlan0" udp dport 53 accept
        iifname "wlan0" tcp dport 53 accept
        ip protocol icmp accept
        ip6 nexthdr icmpv6 accept
        tcp dport 22 accept
        counter drop
    }
}
